<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Third Party Authentication | iQmetrix Developer Portal</title>

    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'/>

    <style>
      /*.highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}*/
    </style>
    <link href="../../stylesheets/two_column.css" rel="stylesheet" media="screen" />
    <link href="../../stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="../../javascripts/all.js"></script>
  </head>

  <body class="guides guides_3pa guides_3pa_index" data-languages="[]">

    <div class="fixed-top">
      <a class="navbar-logo" href="/"><img src="../../images/splash/iqmetrix-logo-white.png" alt="Brand"/></a>
      <div class="navbar-right">
        <ul class="topnav" id="myTopnav">
          <li><a class="active" href="/">PRODUCTS</a></li>
          <li><a href="/api/changelog">API REFERENCE</a></li>
          <li><a href="/api/changelog">CORE CONCEPTS &amp; GUIDES</a></li>
          <li><a href="/api/changelog">PARTNERS</a></li>
          <li><a href="mailto:apisupport@iqmetrix.com?subject=Support">CONTACT</a></li>
          <li class="icon">
            <a href="javascript:void(0);" style="font-size:15px;" onclick="myFunction()">â˜°</a>
          </li>
        </ul>
      </div>
    </div>
    <div class="breadcrumb">
      <ol>
        <li><a href="/api/">API REFERENCE</a></li>
        <li>></li>
        <li><a href="">API DOCUMENTATION</a></li>
        <li>></li>
        <li class="active">CUSTOMER RELATIONSHIP MANAGEMENT (CRM)</li>
      </ol>
    </div>
    <div class="title">
      <h1>API Documentation</h1>
      <p>In depth reference documentation for iQmetrix API's.</p>
    </div>

    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../../images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <!-- <img src="../../images/logo.png" alt="Logo" /> -->
        <div class="lang-selector">
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="content">
        <h1 id="overview">Overview</h1>

<p>This guide describes how you can integrate your existing domain logins with iQmetrix products using <strong>Third Party Authentication (3PA)</strong>.</p>

<div class='bs-callout alert-info'>
<strong>Third Party Authentication (3PA)</strong> is an iQmetrix term referring to the ability of a user to access an iQmetrix product using an external mechanism.
</div>

<p>While this guide is intended to be identity provider agnostic, the examples included are specific to <strong>Microsoft Active Directory Federation Services</strong> for consistency.</p>

<h2 id="implications">Implications</h2>

<p>Enabling Third Party Authentication will limit your ability to:</p>

<ul>
<li>Access iQmetrix Business Intelligence (BI) </li>
<li>Manage passwords in iQmetrix Products</li>
<li>Obtain support from iQmetrix if there are problems with the Identity Provider</li>
</ul>

<h2 id="who-is-this-guide-for">Who Is This Guide For?</h2>

<p>You may be interested in this guide if you want to&hellip;</p>

<ul>
<li>Simplify or automate your IT processes</li>
<li>Reduce the amount of time needed to manage users, credentials and access rights</li>
<li>Allow your users to log into RQ with their Identity Provider credentials</li>
<li>Manage your users in a single place </li>
</ul>

<div class='bs-callout alert-info'>
An <strong>Identity Provider (IdP)</strong> is responsible for providing identifiers for users interacting with a system.
</div>

<h2 id="how-does-third-party-authentication-work">How Does Third Party Authentication Work?</h2>

<p>3PA involves creating a <strong>trusted relationship</strong> between two systems which can enable your users to log into iQmetrix products with their Identity Provider credentials. This is commonly known as <strong>Single Sign On</strong>.</p>

<div class='bs-callout alert-info'>
<strong>Single Sign On (SSO)</strong> permits a user to enter one name and password to access multiple applications. <br/>
One popular example of SSO is the &ldquo;Log In With Facebook&rdquo; button used by many websites to allow users access to a website without creating an account.
</div>

<h3 id="example">Example</h3>

<p>Sarah&rsquo;s Company uses RQ with Third Party Authentication enabled using Microsoft Active Directory Federation Services (ADFS) for authentication.</p>

<p>Sarah enters her domain username and password into RQ.</p>

<p>RQ asks ADFS &ldquo;is this name/password valid?&rdquo; </p>

<p>If ADFS confirms, RQ <strong>trusts</strong> ADFS and allows Sarah to log in successfully. </p>

<p>If ADFS does not confirm, it tells RQ not to allow Sarah access and an error is displayed.</p>

<h1 id="technical-flow">Technical Flow</h1>

<p><strong>Figure 1</strong>: Third Party Authentication Flow</p>

<p><img class="popUpImage" src="http://developers.iqmetrix.com/images/3PAflow.png" alt="Authentication Flow" style="width:60%" /></p>

<ol>
<li>A user from your organization enters their credentials into an iQmetrix product, such as RQ</li>
<li>The application sends a request to iQmetrix&rsquo;s Single Sign On (SSO) service</li>
<li>The SSO service determines if your organization has Third Party Authentication (3PA) enabled</li>
<li>The SSO service sends a POST <a href="http://docs.oasis-open.org/wss/v1.1/wss-v1.1-spec-os-UsernameTokenProfile.pdf">WS-Security UsernameToken Profile 1.1</a> request using the <code class="prettyprint">#PasswordText</code> extension to the URL you supplied</li>
<li>Your Identity Provider responds with a <a href="http://docs.oasis-open.org/wss/v1.1/wss-v1.1-spec-os-SAMLTokenProfile.pdf">WS-Security SAML Token Profile 1.1</a> response with a SAML 2.0 token in the <code class="prettyprint">RequestedSecurityToken</code> element</li>
<li>iQmetrix&rsquo;s Authentication service accepts the response and generates an <a href="http://developers.iqmetrix.com/glossary/#access-token">Access Token</a></li>
<li>The user is able to access the iQmetrix product</li>
</ol>

<h2 id="requirements">Requirements</h2>

<p>Your organization must provide access to an Identity Provider with&hellip;</p>

<ul>
<li>SAML Active Profile using WS-Trust over HTTPS</li>
<li>SSL Protection with a publicly available certificate</li>
<li>Acceptable User Names</li>
<li>High Availability</li>
</ul>

<p>Your Account Manager will need the following information to configure Third Party Authentication:</p>

<ul>
<li>URL of your Identity Provider</li>
<li>An account within the Identity Provider created for RQ support personnel</li>
</ul>

<h3 id="example">Example</h3>

<p>ADFS would require an ADFS Web Application Proxy with iQmetrix added as a Relaying Party Trust.</p>

<h2 id="saml">SAML</h2>

<p><strong>SAML</strong> (Security Assertion Markup Language) is an XML-based data format for exchanging data between systems. </p>

<p>There are many different versions of SAML, but iQmetrix only supports SAML using <strong>WS-Trust</strong>.</p>

<div class='bs-callout alert-info'>
<strong>WS-Trust</strong> or Web Services Trust Language is a specification that uses secure messaging to create a trusted relationships between applications.
</div>

<h3 id="why-not-saml-2-0">Why Not SAML 2.0?</h3>

<p>While SAML 2.0 is widely supported and useful in many situations, it has one major weakness that makes it unsuitable for use with RQ.</p>

<p><strong>Layman&rsquo;s Explanation</strong></p>

<p>Using SAML 2.0, a Windows application like RQ can log in automatically <strong>if</strong> the user logged into the machine with a <strong>personal account</strong>.</p>

<p>This is a problem because RQ is generally installed on a machine with a <strong>shared account</strong>. When a sales rep needs to use RQ they sign in using their own credentials. RQ easily switches between personal sessions in a matter of seconds.</p>

<p>With SAML 2.0, a sales rep would have to sign out of the machine, sign back in with their personal credentials, and re-launch RQ. This would be very time-consuming and negate the benefits of SAML 2.0. </p>

<p>In order to maintain the best possible experience and allow sales reps to quickly switch between RQ sessions, we have implemented a solution based on WS-Trust.</p>

<p><strong>Technical Explanation</strong></p>

<p>The SAML 2.0 protocol supports two profiles,</p>

<ul>
<li>The <strong>Passive</strong> SAML profile redirects the browser to the Identity Provider&rsquo;s sign in page for authentication and then redirects the browser back to the application passing it a SAML token. The passive SAML profile is incompatible with RQ because it is not browser based</li>
<li>The <strong>Active</strong> SAML profile is compatible with RQ but relies on the identity of the user that was authenticated on the host operating system. As RQ is generally installed on shared workstations with a generic user account, the identity of the user cannot be determined using the active SAML profile</li>
</ul>

<p>Given that neither of the SAML 2.0 profiles are suitable for use with RQ, we have implemented an SSO solution based on WS-Trust.</p>

<h2 id="ssl-protection">SSL Protection</h2>

<p><strong>Secure Socket Layer (SSL)</strong> is technology that establishes a secure channel of communication and makes all eCommerce and web security possible.</p>

<p>SSL works by requiring a server to install a <strong>SSL Certificate</strong>, which acts as a key to access the server. For iQmetrix to communicate with your SSL encrypted server, this certificate must be publicly available. </p>

<p>Your organization is responsible for providing an Identity Provider that is protected by SSL and has a publicly-available SSL certificate.</p>

<h2 id="acceptable-user-names">Acceptable User Names</h2>

<p>We strongly recommend you create publicly-accessible domains and map your users to them, rather than using your internal domains. This will ensure that your user names are unique within our system. </p>

<p><strong>Email addresses</strong> are an excellent alternative to domain user names.</p>

<h3 id="example">Example</h3>

<p>A user &ldquo;john.smith@yvr.kentel.local&rdquo; could be mapped to &ldquo;john.smith@kentel.com&rdquo;. </p>

<h2 id="high-availability">High Availability</h2>

<p>High availability means a system is capable of maintaining a high level of operational performance for a period of time. </p>

<p>It is your organization&rsquo;s responsibility to ensure your Identity Provider is highly available. If you are unsure what that requires or if you anticipate problems, please let contact <a href="mailto:apisupport@iqmetrix.com?subject=Support">Support</a> and we can discuss ways to mitigate these.</p>

<h1 id="setup-and-configuration">Setup and Configuration</h1>

<p>It is your responsibility to setup and configure your Identity Provider. </p>

<h3 id="example">Example</h3>

<p>Using ADFS, you may find the following setup guides useful.</p>

<ul>
<li><a href="https://technet.microsoft.com/en-us/library/dn486820.aspx">Windows Server 2012 R2 AD FS Deployment Guide</a></li>
<li><a href="https://technet.microsoft.com/en-us/library/dn508281.aspx">Create a Non-Claims-Aware Relying Party Trust</a></li>
</ul>

<p>In adding a non-claims aware relaying party trust the retailer should use the following values:</p>

<table><thead>
<tr>
<th style="text-align: left">Setting</th>
<th style="text-align: left">Value</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">Display Name</td>
<td style="text-align: left">iQmetrix Services</td>
</tr>
<tr>
<td style="text-align: left">Non-claims-aware relaying party trust identifier</td>
<td style="text-align: left">https://iqmetrix.net</td>
</tr>
<tr>
<td style="text-align: left">Multi-factor Authentication</td>
<td style="text-align: left">I do not want to configure multi-factor authentication settings for this relying party trust at this time</td>
</tr>
</tbody></table>

<h2 id="testing">Testing</h2>

<h5 id="example-request">Example Request</h5>
<pre class="highlight plaintext"><code>POST https://adfs.retaillabs.io/adfs/services/trust/13/UsernameMixed
Content-Type: application/soap+xml
Content-Length: 2255
Expect: 100-continue
Accept-Encoding: gzip, deflate
Connection: Keep-Alive
</code></pre>
<pre class="highlight xml"><code><span class="nt">&lt;s:Envelope</span> <span class="na">xmlns:s=</span><span class="s">"http://www.w3.org/2003/05/soap-envelope"</span> <span class="na">xmlns:a=</span><span class="s">"http://www.w3.org/2005/08/addressing"</span> <span class="na">xmlns:u=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;s:Header&gt;</span>
        <span class="nt">&lt;a:Action</span> <span class="na">s:mustUnderstand=</span><span class="s">"1"</span><span class="nt">&gt;</span>http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue<span class="nt">&lt;/a:Action&gt;</span>
        <span class="nt">&lt;a:MessageID&gt;</span>urn:uuid:2be726b3-e368-4a10-88f3-fd0312c9edc5<span class="nt">&lt;/a:MessageID&gt;</span>
        <span class="nt">&lt;a:ReplyTo&gt;</span>
            <span class="nt">&lt;a:Address&gt;</span>http://www.w3.org/2005/08/addressing/anonymous<span class="nt">&lt;/a:Address&gt;</span>
        <span class="nt">&lt;/a:ReplyTo&gt;</span>
        <span class="nt">&lt;a:To</span> <span class="na">s:mustUnderstand=</span><span class="s">"1"</span><span class="nt">&gt;</span>https://adfs.retaillabs.io/adfs/services/trust/13/UsernameMixed<span class="nt">&lt;/a:To&gt;</span>
        <span class="nt">&lt;o:Security</span> <span class="na">s:mustUnderstand=</span><span class="s">"1"</span> <span class="na">xmlns:o=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;u:Timestamp</span> <span class="na">u:Id=</span><span class="s">"_0"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;u:Created&gt;</span>2015-06-30T20:16:13.639Z<span class="nt">&lt;/u:Created&gt;</span>
                <span class="nt">&lt;u:Expires&gt;</span>2015-06-30T20:21:13.639Z<span class="nt">&lt;/u:Expires&gt;</span>
            <span class="nt">&lt;/u:Timestamp&gt;</span>
            <span class="nt">&lt;o:UsernameToken</span> <span class="na">u:Id=</span><span class="s">"uuid-2ed4cc51-2345-446c-be94-9af4ab99d24c-1"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;o:Username&gt;</span>Nicola.Tesla@retaillabs.local<span class="nt">&lt;/o:Username&gt;</span>
                <span class="nt">&lt;o:Password</span> <span class="na">Type=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText"</span><span class="nt">&gt;</span>4AlternatingCurrent<span class="nt">&lt;/o:Password&gt;</span>
            <span class="nt">&lt;/o:UsernameToken&gt;</span>
        <span class="nt">&lt;/o:Security&gt;</span>
    <span class="nt">&lt;/s:Header&gt;</span>
    <span class="nt">&lt;s:Body&gt;</span>
        <span class="nt">&lt;trust:RequestSecurityToken</span> <span class="na">xmlns:trust=</span><span class="s">"http://docs.oasis-open.org/ws-sx/ws-trust/200512"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;wsp:AppliesTo</span> <span class="na">xmlns:wsp=</span><span class="s">"http://schemas.xmlsoap.org/ws/2004/09/policy"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a:EndpointReference&gt;</span>
                    <span class="nt">&lt;a:Address&gt;</span>https://iqmetrix.net/<span class="nt">&lt;/a:Address&gt;</span>
                <span class="nt">&lt;/a:EndpointReference&gt;</span>
            <span class="nt">&lt;/wsp:AppliesTo&gt;</span>
            <span class="nt">&lt;trust:Claims</span> <span class="na">Dialect=</span><span class="s">"http://schemas.xmlsoap.org/ws/2005/05/identity"</span> <span class="na">xmlns:i=</span><span class="s">"http://schemas.xmlsoap.org/ws/2005/05/identity"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;i:ClaimType</span> <span class="na">Uri=</span><span class="s">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn"</span> <span class="na">Optional=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;i:ClaimType</span> <span class="na">Uri=</span><span class="s">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"</span> <span class="na">Optional=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;i:ClaimType</span> <span class="na">Uri=</span><span class="s">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname"</span> <span class="na">Optional=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;i:ClaimType</span> <span class="na">Uri=</span><span class="s">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname"</span> <span class="na">Optional=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/trust:Claims&gt;</span>
            <span class="nt">&lt;trust:KeyType&gt;</span>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Bearer<span class="nt">&lt;/trust:KeyType&gt;</span>
            <span class="nt">&lt;trust:RequestType&gt;</span>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Issue<span class="nt">&lt;/trust:RequestType&gt;</span>
            <span class="nt">&lt;trust:TokenType&gt;</span>urn:oasis:names:tc:SAML:2.0:assertion<span class="nt">&lt;/trust:TokenType&gt;</span>
        <span class="nt">&lt;/trust:RequestSecurityToken&gt;</span>
    <span class="nt">&lt;/s:Body&gt;</span>
<span class="nt">&lt;/s:Envelope&gt;</span>
</code></pre>

<h5 id="example-response">Example Response</h5>
<pre class="highlight plaintext"><code>HTTP 200 Content-Type: application/soap+xml
</code></pre>
<pre class="highlight xml"><code><span class="nt">&lt;s:Envelope</span> <span class="na">xmlns:s=</span><span class="s">"http://www.w3.org/2003/05/soap-envelope"</span> <span class="na">xmlns:a=</span><span class="s">"http://www.w3.org/2005/08/addressing"</span> <span class="na">xmlns:u=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;s:Header&gt;</span>
        <span class="nt">&lt;a:Action</span> <span class="na">s:mustUnderstand=</span><span class="s">"1"</span><span class="nt">&gt;</span>http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTRC/IssueFinal<span class="nt">&lt;/a:Action&gt;</span>
        <span class="nt">&lt;a:RelatesTo&gt;</span>urn:uuid:2be726b3-e368-4a10-88f3-fd0312c9edc5<span class="nt">&lt;/a:RelatesTo&gt;</span>
        <span class="nt">&lt;o:Security</span> <span class="na">s:mustUnderstand=</span><span class="s">"1"</span> <span class="na">xmlns:o=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;u:Timestamp</span> <span class="na">u:Id=</span><span class="s">"_0"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;u:Created&gt;</span>2015-06-30T20:16:15.509Z<span class="nt">&lt;/u:Created&gt;</span>
                <span class="nt">&lt;u:Expires&gt;</span>2015-06-30T20:21:15.509Z<span class="nt">&lt;/u:Expires&gt;</span>
            <span class="nt">&lt;/u:Timestamp&gt;</span>
        <span class="nt">&lt;/o:Security&gt;</span>
    <span class="nt">&lt;/s:Header&gt;</span>
    <span class="nt">&lt;s:Body&gt;</span>
        <span class="nt">&lt;trust:RequestSecurityTokenResponseCollection</span> <span class="na">xmlns:trust=</span><span class="s">"http://docs.oasis-open.org/ws-sx/ws-trust/200512"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;trust:RequestSecurityTokenResponse&gt;</span>
                <span class="nt">&lt;trust:Lifetime&gt;</span>
                    <span class="nt">&lt;wsu:Created</span> <span class="na">xmlns:wsu=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"</span><span class="nt">&gt;</span>2015-06-30T20:16:15.505Z<span class="nt">&lt;/wsu:Created&gt;</span>
                    <span class="nt">&lt;wsu:Expires</span> <span class="na">xmlns:wsu=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"</span><span class="nt">&gt;</span>2015-06-30T21:16:15.505Z<span class="nt">&lt;/wsu:Expires&gt;</span>
                <span class="nt">&lt;/trust:Lifetime&gt;</span>
                <span class="nt">&lt;wsp:AppliesTo</span> <span class="na">xmlns:wsp=</span><span class="s">"http://schemas.xmlsoap.org/ws/2004/09/policy"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;wsa:EndpointReference</span> <span class="na">xmlns:wsa=</span><span class="s">"http://www.w3.org/2005/08/addressing"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;wsa:Address&gt;</span>https://iqmetrix.net<span class="nt">&lt;/wsa:Address&gt;</span>
                    <span class="nt">&lt;/wsa:EndpointReference&gt;</span>
                <span class="nt">&lt;/wsp:AppliesTo&gt;</span>
                <span class="nt">&lt;trust:RequestedSecurityToken&gt;</span>
                    <span class="nt">&lt;Assertion</span> <span class="na">ID=</span><span class="s">"_62c0ac75-0267-46cf-95a6-91b9cdc8ed79"</span> <span class="na">IssueInstant=</span><span class="s">"2015-06-30T20:16:15.509Z"</span> <span class="na">Version=</span><span class="s">"2.0"</span> <span class="na">xmlns=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:assertion"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;Issuer&gt;</span>http://adfs.retaillabs.io/adfs/services/trust<span class="nt">&lt;/Issuer&gt;</span>
                        <span class="nt">&lt;ds:Signature</span> <span class="na">xmlns:ds=</span><span class="s">"http://www.w3.org/2000/09/xmldsig#"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;ds:SignedInfo&gt;</span>
                                <span class="nt">&lt;ds:CanonicalizationMethod</span> <span class="na">Algorithm=</span><span class="s">"http://www.w3.org/2001/10/xml-exc-c14n#"</span><span class="nt">/&gt;</span>
                                <span class="nt">&lt;ds:SignatureMethod</span> <span class="na">Algorithm=</span><span class="s">"http://www.w3.org/2000/09/xmldsig#rsa-sha1"</span><span class="nt">/&gt;</span>
                                <span class="nt">&lt;ds:Reference</span> <span class="na">URI=</span><span class="s">"#_62c0ac75-0267-46cf-95a6-91b9cdc8ed79"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;ds:Transforms&gt;</span>
                                        <span class="nt">&lt;ds:Transform</span> <span class="na">Algorithm=</span><span class="s">"http://www.w3.org/2000/09/xmldsig#enveloped-signature"</span><span class="nt">/&gt;</span>
                                        <span class="nt">&lt;ds:Transform</span> <span class="na">Algorithm=</span><span class="s">"http://www.w3.org/2001/10/xml-exc-c14n#"</span><span class="nt">/&gt;</span>
                                    <span class="nt">&lt;/ds:Transforms&gt;</span>
                                    <span class="nt">&lt;ds:DigestMethod</span> <span class="na">Algorithm=</span><span class="s">"http://www.w3.org/2000/09/xmldsig#sha1"</span><span class="nt">/&gt;</span>
                                    <span class="nt">&lt;ds:DigestValue&gt;</span>nWRVS/+EPGC10gyKqvuLcXLhwE8=<span class="nt">&lt;/ds:DigestValue&gt;</span>
                                <span class="nt">&lt;/ds:Reference&gt;</span>
                            <span class="nt">&lt;/ds:SignedInfo&gt;</span>
                            <span class="nt">&lt;ds:SignatureValue&gt;</span>lCi93bMFIoSOmf4uBq95OF4LO7c5mARkR4x/1LagKDBS/iKMEi73EmxtZJ5o9L/OAfIueaKrdtiXFJXqB5KysA3WAjuMDVtaDfbJzhMhqZnXB2NrShA0vBM4cfCFj1VJe9ozTQiQUVtL/O0HTM06jCMHwJhbl1DMdTdZt9OejDfBtJDk5wr0TGLBmDYuVjIb2k+nWIWvCCjmOQbHlK65IcFaOQoXYjdwGu4YWttejC4m+sqgnAH926t9eorxpY928EVxN5xoB/UFSQFpnfQvPgfogu1EeByF2mwvbdf/qNIMtejF4AqAq6RUWvdhcFy+VDJqeWYBN2UY9LP4XdIU0g==<span class="nt">&lt;/ds:SignatureValue&gt;</span>
                            <span class="nt">&lt;KeyInfo</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/2000/09/xmldsig#"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;ds:X509Data&gt;</span>
                                    <span class="nt">&lt;ds:X509Certificate&gt;</span>MIIC4DCCAcigAwIBAgIQNGL3q/dLsoFBwDzHqMXstjANBgkqhkiG9w0BAQsFADAsMSowKAYDVQQDEyFBREZTIFNpZ25pbmcgLSBhZGZzLnJldGFpbGxhYnMuaW8wHhcNMTUwMTIxMjEwNTI4WhcNMTYwMTIxMjEwNTI4WjAsMSowKAYDVQQDEyFBREZTIFNpZ25pbmcgLSBhZGZzLnJldGFpbGxhYnMuaW8wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCo1zytlu3USZhnj9bVcIVcvhWr5ojuYNzvR8mX/enOcIyoPzlP+0nSaoajTxutLi5uXYE27bRtnVQ6vWwLCMJ5TLxW1LvgcE4yNQg2ns+f0mI27Nvic4xTP4Yhh6CzYdxSbJURGKKSOvTKTmNJttqNGUvpJRakavKC6zF6ZniA+E7AlL6ONQd+E7O80WdybK44vwiDxaPcgHlqIRAn6cHgYL9WgC8NMt8plJFxN4oxnUpIiyS2jyWWs3PfOsgFIWqmx18s6TpH8VEJ7JOJkC5vhHZ6RPXxnS5EkpOd24IzvwSrmMmYRcb3LLQptcGymD4s1YVKkoKp2JAdJIBtTdj3AgMBAAEwDQYJKoZIhvcNAQELBQADggEBAFON9MIWas0ftf+No80T1LIRNh0kbvAFTYTDycLN1XzoIy1mCM0E+iRGe6ZmGNDgc+I11ZFbvvgV2DT/PLXlafRnKLomPWAZfzYHp1doWGFCFjBKQG6W0KjwTBxJTEy0v76I3q/BMBMn3iEr+uJvaDzsM212IImJqPvFsiQR3rEEoSZAWNNe8SVp3WiwoPXIv+hDuo1cRArroXb0rmZff/ubHWMJZz+4/RoLYz/EPCNDoygT7M/cV4mC5RVrvWC8eG8Gw9jBMeFXKQWcrS6PWY9py/f2nCzdmx8OPj9BhLoPc6ieD2ed44tIX58JhFdQxNfo7F4LAa4uZgi73Kzf9Bo=<span class="nt">&lt;/ds:X509Certificate&gt;</span>
                                <span class="nt">&lt;/ds:X509Data&gt;</span>
                            <span class="nt">&lt;/KeyInfo&gt;</span>
                        <span class="nt">&lt;/ds:Signature&gt;</span>
                        <span class="nt">&lt;Subject&gt;</span>
                            <span class="nt">&lt;SubjectConfirmation</span> <span class="na">Method=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:cm:bearer"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;SubjectConfirmationData</span> <span class="na">NotOnOrAfter=</span><span class="s">"2015-06-30T20:21:15.509Z"</span><span class="nt">/&gt;</span>
                            <span class="nt">&lt;/SubjectConfirmation&gt;</span>
                        <span class="nt">&lt;/Subject&gt;</span>
                        <span class="nt">&lt;Conditions</span> <span class="na">NotBefore=</span><span class="s">"2015-06-30T20:16:15.505Z"</span> <span class="na">NotOnOrAfter=</span><span class="s">"2015-06-30T21:16:15.505Z"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;AudienceRestriction&gt;</span>
                                <span class="nt">&lt;Audience&gt;</span>https://iqmetrix.net<span class="nt">&lt;/Audience&gt;</span>
                            <span class="nt">&lt;/AudienceRestriction&gt;</span>
                        <span class="nt">&lt;/Conditions&gt;</span>
                        <span class="nt">&lt;AttributeStatement&gt;</span>
                            <span class="nt">&lt;Attribute</span> <span class="na">Name=</span><span class="s">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;AttributeValue&gt;</span>Nicola.Tesla@retaillabs.local<span class="nt">&lt;/AttributeValue&gt;</span>
                            <span class="nt">&lt;/Attribute&gt;</span>
                        <span class="nt">&lt;/AttributeStatement&gt;</span>
                        <span class="nt">&lt;AuthnStatement</span> <span class="na">AuthnInstant=</span><span class="s">"2015-06-30T20:16:15.477Z"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;AuthnContext&gt;</span>
                                <span class="nt">&lt;AuthnContextClassRef&gt;</span>urn:oasis:names:tc:SAML:2.0:ac:classes:Password<span class="nt">&lt;/AuthnContextClassRef&gt;</span>
                            <span class="nt">&lt;/AuthnContext&gt;</span>
                        <span class="nt">&lt;/AuthnStatement&gt;</span>
                    <span class="nt">&lt;/Assertion&gt;</span>
                <span class="nt">&lt;/trust:RequestedSecurityToken&gt;</span>
                <span class="nt">&lt;trust:RequestedAttachedReference&gt;</span>
                    <span class="nt">&lt;SecurityTokenReference</span> <span class="na">b:TokenType=</span><span class="s">"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0"</span> <span class="na">xmlns=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"</span> <span class="na">xmlns:b=</span><span class="s">"http://docs.oasis-open.org/wss/oasis-wss-wssecurity-secext-1.1.xsd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;KeyIdentifier</span> <span class="na">ValueType=</span><span class="s">"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLID"</span><span class="nt">&gt;</span>_62c0ac75-0267-46cf-95a6-91b9cdc8ed79<span class="nt">&lt;/KeyIdentifier&gt;</span>
                    <span class="nt">&lt;/SecurityTokenReference&gt;</span>
                <span class="nt">&lt;/trust:RequestedAttachedReference&gt;</span>
                <span class="nt">&lt;trust:RequestedUnattachedReference&gt;</span>
                    <span class="nt">&lt;SecurityTokenReference</span> <span class="na">b:TokenType=</span><span class="s">"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0"</span> <span class="na">xmlns=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"</span> <span class="na">xmlns:b=</span><span class="s">"http://docs.oasis-open.org/wss/oasis-wss-wssecurity-secext-1.1.xsd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;KeyIdentifier</span> <span class="na">ValueType=</span><span class="s">"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLID"</span><span class="nt">&gt;</span>_62c0ac75-0267-46cf-95a6-91b9cdc8ed79<span class="nt">&lt;/KeyIdentifier&gt;</span>
                    <span class="nt">&lt;/SecurityTokenReference&gt;</span>
                <span class="nt">&lt;/trust:RequestedUnattachedReference&gt;</span>
                <span class="nt">&lt;trust:TokenType&gt;</span>urn:oasis:names:tc:SAML:2.0:assertion<span class="nt">&lt;/trust:TokenType&gt;</span>
                <span class="nt">&lt;trust:RequestType&gt;</span>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Issue<span class="nt">&lt;/trust:RequestType&gt;</span>
                <span class="nt">&lt;trust:KeyType&gt;</span>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Bearer<span class="nt">&lt;/trust:KeyType&gt;</span>
            <span class="nt">&lt;/trust:RequestSecurityTokenResponse&gt;</span>
        <span class="nt">&lt;/trust:RequestSecurityTokenResponseCollection&gt;</span>
    <span class="nt">&lt;/s:Body&gt;</span>
<span class="nt">&lt;/s:Envelope&gt;</span>
</code></pre>

<p>When you are ready to test the integration, contact <a href="mailto:apisupport@iqmetrix.com?subject=Support">Support</a> to request the 3PA testing utility.</p>

<h2 id="requested-claims">Requested Claims</h2>

<p>The following is a list of claims that will be requested:</p>

<table><thead>
<tr>
<th style="text-align: left">Claim</th>
<th style="text-align: left">Required/Optional</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn</code></td>
<td style="text-align: left">Required</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress</code></td>
<td style="text-align: left">Optional</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname</code></td>
<td style="text-align: left">Optional</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname</code></td>
<td style="text-align: left">Optional</td>
</tr>
</tbody></table>

<h1 id="managing-users">Managing Users</h1>

<p>While Third Party Authentication can provide your users access to iQmetrix products, it does not have the ability to manage what those users can see or do once they are logged in. </p>

<p>Manging users can be done through&hellip;</p>

<ul>
<li>iQmetrix applications such as RQ</li>
<li><a href="/api/user-manager/">User Manager API</a> for an automated solution or</li>
<li><a href="https://hub.iqmetrix.net/">Hub</a> for a web-based solution or</li>
<li><a href="#automated-provisioning">Automated Provisioning</a></li>
</ul>

<h1 id="automated-provisioning">Automated Provisioning</h1>

<p><strong>Automated Provisioning</strong> or auto-provisioning is a process that involves managing a service in one or more systems automatically. </p>

<p>When combined with 3PA, Automated Provisioning allows you to manage users in iQmetrix services by auto-provisioning them from your existing Identity Provider.</p>

<p>For troubleshooting errors and problems, see <a href="/faq/3pa/">Automated Provisioning FAQ</a>.</p>

<h3 id="example">Example</h3>

<p>Sarah&rsquo;s Company uses RQ with Third Party Authentication and Auto Provisioning enabled using ADFS for authentication.</p>

<p>Sarah gets a promotion and is given a manager security role within ADFS.</p>

<p>She enters her credentials in RQ, which asks ADFS &ldquo;is this name/password valid?&rdquo;. </p>

<p>ADFS confirms and says &ldquo;also, Sarah now has a manager security role&rdquo;. RQ can then update the security for Sarah, so she is able to access areas of RQ restricted to managers.</p>

<h2 id="requirements">Requirements</h2>

<p>Automated Provisioning requires your organization to have&hellip;</p>

<ul>
<li>Third Party Authentication enabled</li>
<li>A domain name that is unique within iQmetrix&rsquo;s systems</li>
</ul>

<p>You will need to work with your Account Manager to map your Identity Provider roles to <a href="/api/security-roles/#securityrole">Security Roles</a>.</p>

<p>To maintain this mapping, you will need to update <a href="https://hub.iqmetrix.net">iQmetrix Hub</a> or RQ when new roles are added or existing roles are updated.</p>

<p>In addition, you will need to set and maintain a mapping using the ClientEntityId property on <a href="http://developers.iqmetrix.com/api/company-tree/#companytreenode">CompanyTreeNode</a> resources. This must be done using the Company Tree API.</p>

<p>All user information that is supplied with authentication should be maintained in your Identity Provider. </p>

<h2 id="implications">Implications</h2>

<p>Enabling Automated Provisioning will result in&hellip;</p>

<ul>
<li>A slight configuration delay during login</li>
<li>Limited ability to use the User Manager API - changes that do not match the Identity Provider will revert back the next time the user logs in</li>
<li>An error message if there is a problem configuring a user, the message will indicate how to solve the problem</li>
</ul>

<h2 id="technical-flow">Technical Flow</h2>

<p>When added to 3PA, Automated Provisioning changes the technical flow by sending user information along with the POST request sent to the supplied URL. (Step 4 of <a href="#technical-flow">Technical Flow</a>).</p>

<h2 id="claims">Claims</h2>

<p>The following is a list of claims that will be requested.</p>

<p>Notes:</p>

<ul>
<li>We <strong>strongly recommend</strong> you include a ClientUserId, a user identifier, to avoid creating duplicate user accounts</li>
<li>Before Windows 2000, username is not supported</li>
<li>If an expected claim is not returned, exiting data will be wiped</li>
</ul>

<p>It may be possible to support custom claims if further user information is required, see <a href="#adding-additional-rq-fields-to-an-employee">Adding Additional RQ Fields to an Employee</a>.</p>

<div class='bs-callout alert-info'>
To learn more about Employee Custom Fields, see <a href='https://support.iqmetrix.com/hc/en-us/articles/228837927-Settings-Employees#Employee_Custom_Fields_Setup'>Employee Custom Fields Setup</a>
</div>

<table><thead>
<tr>
<th style="text-align: left">ClaimType</th>
<th style="text-align: left">Required in RQ?</th>
<th style="text-align: left">Required in Hub?</th>
<th style="text-align: left">Populates Field</th>
<th style="text-align: left">Example</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn</code></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">Required</td>
<td style="text-align: left"><a href="/api/user-manager/#user">User</a>.UserName</td>
<td style="text-align: left">Nicola.Tesla@retaillabs.com</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname</code></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left"><a href="/api/user-manager/#user">User</a>.FirstName</td>
<td style="text-align: left">Nicola</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname</code></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left"><a href="/api/user-manager/#user">User</a>.LastName</td>
<td style="text-align: left">Tesla</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress</code></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left"><a href="/api/user-manager/#user">User</a>.Email</td>
<td style="text-align: left">ntesla@retaillabs.com</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://iqmetrix.net/claims/telephoneNumbers/home</code></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left"><a href="/api/user-manager/#user">User</a>.PhoneNumbers</td>
<td style="text-align: left">604-123-4567x1000</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://iqmetrix.net/claims/telephoneNumbers/work</code></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left"><a href="/api/user-manager/#user">User</a>.PhoneNumbers</td>
<td style="text-align: left">604-654-3210x1234</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://iqmetrix.net/claims/telephoneNumbers/cell</code></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left"><a href="/api/user-manager/#user">User</a>.PhoneNumbers</td>
<td style="text-align: left">604-654-6543</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://iqmetrix.net/claims/securityGroupName</code></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left"><a href="/api/security-roles/#assignedrole">AssignedRole</a></td>
<td style="text-align: left">StoreManagers</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://iqmetrix.net/claims/assignedEntityClientEntityId</code></td>
<td style="text-align: left">Optional*</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Assigned <a href="/api/company-tree/#location">Location</a></td>
<td style="text-align: left">TheMarketCode</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://iqmetrix.net/claims/assignedEntityClientEntityIds</code></td>
<td style="text-align: left">Optional*</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Assigned <a href="/api/company-tree/#location">Locations</a></td>
<td style="text-align: left">Market1,Market2,Market3</td>
</tr>
<tr>
<td style="text-align: left"><code class="prettyprint">http://iqmetrix.net/claims/clientUserId</code></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left"><a href="/api/user-manager/#user">User</a>.ClientUserID</td>
<td style="text-align: left">22323</td>
</tr>
</tbody></table>

<ul>
<li>Note: The presence of at least one of the &ldquo;assignedEntityClientEntityId&rdquo; claims is required for RQ.</li>
</ul>

<h2 id="adding-additional-rq-fields-to-an-employee">Adding Additional RQ Fields to an Employee</h2>

<p>You can auto-provision fields not listed above using attributes. For company-specific Custom fields, the <code class="prettyprint">rqCustomField</code> prefix is required.</p>

<div class='bs-callout alert-info'>
Before adding additional fields, discuss your requirements with your Account Manager to ensure they will appear in RQ
</div>

<table><thead>
<tr>
<th style="text-align: left">Claim</th>
<th style="text-align: left">Value</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code class="prettyprint">http://iqmetrix.net/claims/attributes/rqCustomField_{AttrName}</code></td>
<td style="text-align: left">TheValue</td>
<td style="text-align: left">Add TheValue to the {AttrName} field for the employee in RQ</td>
</tr>
</tbody></table>

<p><strong>Figure 2:</strong> Custom Employee Attributes in RQ </p>

<p><img class="popUpImage" src="http://developers.iqmetrix.com/images/3pa/rq-view.png" alt="Custom Employee Attributes in RQ" style="border: 1px solid grey" /></p>

      </div>
  </body>
</html>
